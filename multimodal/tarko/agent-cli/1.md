## 目标

在 https://github.com/bytedance/UI-TARS-desktop/pull/1445 的基础上，为 `multimodal/tarko/agent-ui-builder` 在现有 Node.js API 的基础上，实现一个 AGUI CLI（`@tarko/agent-ui-cli`）：

## 使用姿势

### 安装

```bash
npm install @tarko/agent-ui-cli
```

### 生成一份报告

```bash
agui dump ./trace.json
```

会构建出 `tarko-agui-{timestamp}.html` 到当前目录中。


`trace.json` 默认支持的格式如下：

1. 导出一个对象，包含字段 `events: AgentEventStream.Event[]` 的 Object，与 Tarko Server 的 session events 存储格式对齐:

```json
{
    "events": [
       {},
       {},
       {},
   ]
}
```

2. 以 `jsonl` 导出一个 `AgentEventStream.Event[]`:

```jsonl
{}
{}
{}
```


### 指定输出路径

```bash
agui ./trace.json --out ./agent-ui.html
```

会构建出 `agent-ui.html` 到当前目录中


### 指定 Trace Transformer

如果 ./trace.json 不是一个符合 Tarko Agent UI Protocol 的 Agent Event Stream，那么可以实现一个 transformer.ts，将其转换为符合格式的 events:

```bash
agui ./trace.json —transformer ./transformer.ts
```

一个 transformer.ts 实现示例如下，接受 trace.json 的原始值作为输入，返回一个包含字段 `events: AgentEventStream.Event[]` 的 Object

```ts
import { AgentEventStream } from '@tarko/interface';

export function <T extends unknown>(input: T): { events: AgentEventStream.Event[] } {
    // ...
}
```


### 指定其他生成配置

```
agui ./trace.json —transformer ./seed-code-transformer.ts —config ./config.json
```

使用 js、ts 维护配置，使用 @tarko/config-loader 加载，默认为 `{agui.config.json|ts}`，配置示例如下：

```ts
export default {
  /**
   * Event Stream
   */
  events: events as unknown as AgentEventStream.Event[],
  /**
   * Session Information
   */
  sessionInfo: {
    id: 'sessionId',
    createdAt: Date.now(),
    updatedAt: Date.now(),
    workspace: '~/workspace',
    metadata: {
      name: 'Use jupyter to calculate who is greater in 9.11 and 9.9',
      tags: [],
      modelConfig: {
        provider: 'volcengine',
        modelId: 'ep-20250905175225-hlrvd',
        displayName: 'UI-TARS-2',
        configuredAt: Date.now(),
      },
      agentInfo: {
        name: 'Omni Agent',
        configuredAt: Date.now(),
      },
    },
  },
  /**
   * Server Information
   */
  serverInfo: {
    version: '1.0.0',
    buildTime: Date.now(),
    gitHash: '1234567',
  },
  /**
   * UI Configuration
   */
  uiConfig: {
    logo: 'https://lf3-static.bytednsdoc.com/obj/eden-cn/zyha-aulnh/ljhwZthlaukjlkulzlp/icon.png',
    title: 'Omni Agent',
    subtitle: 'Offering seamless integration with a wide range of real-world tools.',
    welcomTitle: 'A multimodal AI agent',
    guiAgent: {
      defaultScreenshotRenderStrategy: 'afterAction',
      enableScreenshotRenderStrategySwitch: true,
      renderGUIAction: true,
      renderBrowserShell: false,
    },
  },
}
```

### 一键上传

```bash
agui ./trace.json --transformer ./transformer.ts —-config ./config.json —-upload http://...
```

返回一个可访问的 HTML 链接

## 技术实现

1. 与 multimodal/tarko/agent-cli/src/core/cli.ts 对齐，使用 cac
2. `multimodal/tarko/agent-ui-builder` 需要设计配置默认值，因此 CLI 场景下，除了 events，其他的都是 Optional 的，尤其是那些 timestamp
3. 在架构上，请保证 CLI 与 Node.js API 高度对齐，保持干净，勿增实体

