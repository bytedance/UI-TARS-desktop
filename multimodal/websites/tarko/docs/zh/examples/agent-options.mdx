---
title: Agent 选项示例
description: 学习如何使用 Agent 选项实现可配置的智能体行为
---

# Agent 选项示例

Agent 选项允许您创建可配置的、特定于会话的设置，用户可以直接从聊天界面切换这些设置。这使得无需更改代码或重启服务器即可实现动态智能体行为定制。

## 概述

本指南提供了在 Tarko 应用程序中实现 Agent 选项的实用示例：

- **基础示例**：具有基本选项的简单聊天机器人
- **高级示例**：具有广泛定制功能的复杂多模态助手

## 基础示例

一个具有基本智能体选项的简单聊天机器人：

```typescript
import { Agent, createTool } from '@tarko/agent';
import { AgentServerOptions } from '@tarko/interface';

// 1. 定义 Agent 选项架构
const serverOptions: AgentServerOptions = {
  port: 3000,
  agentOptions: {
    type: 'object',
    properties: {
      // 布尔选项 - 切换开关
      verboseMode: {
        type: 'boolean',
        title: '详细模式',
        description: '在回复中提供详细解释',
        default: false,
      },

      // 二元枚举 - 切换按钮
      responseStyle: {
        type: 'string',
        title: '回复风格',
        description: '选择智能体的回复方式',
        enum: ['casual', 'formal'],
        default: 'casual',
      },

      // 多元枚举 - 下拉菜单
      language: {
        type: 'string',
        title: '回复语言',
        description: '智能体回复的语言',
        enum: ['chinese', 'english', 'japanese'],
        default: 'chinese',
      },
    },
  },
};

// 2. 创建支持选项的智能体
class BasicChatAgent extends Agent {
  constructor() {
    super({
      name: 'BasicChatAgent',
      instructions: '你是一个能够适应用户偏好的有用助手。',
      model: {
        apiKey: process.env.OPENAI_API_KEY,
        baseURL: 'https://api.openai.com/v1',
        model: 'gpt-4'
      }
    });
  }

  async run(input: string, runOptions?: { sessionId?: string }) {
    // 从会话元数据获取当前选项
    const sessionMetadata = this.getEventStream().getSessionMetadata(runOptions?.sessionId);
    const options = sessionMetadata?.agentOptions || {};

    const isVerbose = options.verboseMode || false;
    const style = options.responseStyle || 'casual';
    const language = options.language || 'chinese';

    // 根据选项自定义指令
    let customInstructions = this.instructions;

    // 如果启用详细模式，添加详细指令
    if (isVerbose) {
      customInstructions += this.getVerboseInstruction(language);
    }

    // 添加风格指令
    customInstructions += this.getStyleInstruction(style, language);

    // 添加语言指令
    customInstructions += this.getLanguageInstruction(language);

    // 临时更新此次运行的指令
    const originalInstructions = this.instructions;
    this.instructions = customInstructions;

    try {
      const result = await super.run(input);
      return result;
    } finally {
      // 恢复原始指令
      this.instructions = originalInstructions;
    }
  }

  private getVerboseInstruction(language: string): string {
    const instructions = {
      chinese: '\n\n始终提供详细的解释并逐步展示您的推理过程。',
      english: '\n\nAlways provide detailed explanations and show your reasoning process step by step.',
      japanese: '\n\n常に詳細な説明を提供し、推論プロセスを段階的に示してください。',
    };
    return instructions[language] || instructions.chinese;
  }

  private getStyleInstruction(style: string, language: string): string {
    const styles = {
      chinese: {
        casual: '\n\n在回复中使用随意、友好的语调。',
        formal: '\n\n在回复中保持正式、专业的语调。',
      },
      english: {
        casual: '\n\nUse a casual, friendly tone in your responses.',
        formal: '\n\nMaintain a formal, professional tone in your responses.',
      },
      japanese: {
        casual: '\n\n回答ではカジュアルでフレンドリーなトーンを使用してください。',
        formal: '\n\n回答では正式で専門的なトーンを維持してください。',
      },
    };
    return styles[language]?.[style] || styles.chinese.casual;
  }

  private getLanguageInstruction(language: string): string {
    const instructions = {
      chinese: '\n\n用中文回复。',
      english: '\n\nRespond in English.',
      japanese: '\n\n日本語で回答してください。',
    };
    return instructions[language] || instructions.chinese;
  }
}

export { serverOptions, BasicChatAgent };
```

## 高级示例

一个具有广泛定制功能的综合多模态 AI 助手：

```typescript
import { Agent, createTool } from '@tarko/agent';
import { AgentServerOptions } from '@tarko/interface';

// 高级智能体选项配置
const advancedServerOptions: AgentServerOptions = {
  port: 3000,
  agentOptions: {
    type: 'object',
    properties: {
      // === UI 行为选项 ===
      showThinkingProcess: {
        type: 'boolean',
        title: '显示思考过程',
        description: '在回复中显示逐步推理',
        default: true,
      },

      showProgressIndicators: {
        type: 'boolean',
        title: '显示进度',
        description: '为长时间操作显示进度指示器',
        default: true,
      },

      // === 智能体个性 ===
      personalityMode: {
        type: 'string',
        title: '个性',
        description: '智能体的沟通和行为方式',
        enum: ['professional', 'friendly', 'technical', 'creative'],
        default: 'friendly',
      },

      communicationStyle: {
        type: 'string',
        title: '沟通风格',
        description: '回复的语调和方法',
        enum: ['concise', 'detailed', 'explanatory'],
        default: 'detailed',
      },

      // === 工具和功能控制 ===
      enableWebSearch: {
        type: 'boolean',
        title: '网络搜索',
        description: '允许智能体搜索互联网获取最新信息',
        default: false,
      },

      enableCodeGeneration: {
        type: 'boolean',
        title: '代码生成',
        description: '启用自动代码生成和执行',
        default: true,
      },

      enableImageAnalysis: {
        type: 'boolean',
        title: '图像分析',
        description: '分析和描述上传的图像',
        default: true,
      },

      // === 输出格式选项 ===
      preferredCodeLanguage: {
        type: 'string',
        title: '代码语言',
        description: '代码示例的默认编程语言',
        enum: ['typescript', 'javascript', 'python', 'go', 'rust'],
        default: 'typescript',
      },

      outputFormat: {
        type: 'string',
        title: '输出格式',
        description: '如何构建回复',
        enum: ['markdown', 'html', 'plain'],
        default: 'markdown',
      },

      includeSourceReferences: {
        type: 'boolean',
        title: '来源引用',
        description: '在回复中包含引用和参考资料',
        default: true,
      },

      // === 性能和限制 ===
      maxReasoningSteps: {
        type: 'string',
        title: '最大推理步骤',
        description: '复杂问题的最大推理步骤数',
        enum: ['5', '10', '20', 'unlimited'],
        default: '10',
      },

      responseTimePreference: {
        type: 'string',
        title: '响应速度',
        description: '响应速度与质量之间的平衡',
        enum: ['fast', 'balanced', 'thorough'],
        default: 'balanced',
      },

      // === 内容过滤 ===
      contentSafetyLevel: {
        type: 'string',
        title: '内容安全',
        description: '内容过滤和安全检查的级别',
        enum: ['strict', 'moderate', 'permissive'],
        default: 'moderate',
      },

      // === 实验性功能 ===
      enableExperimentalFeatures: {
        type: 'boolean',
        title: '实验性功能',
        description: '启用前沿功能（可能不稳定）',
        default: false,
      },
    },
  },
};

// 高级智能体实现
class AdvancedMultiModalAgent extends Agent {
  constructor() {
    super({
      name: 'AdvancedMultiModalAgent',
      instructions: '你是一个具有广泛定制选项的高级 AI 助手。',
      tools: [
        createTool({
          name: 'web_search',
          description: '搜索网络获取最新信息',
          parameters: {
            type: 'object',
            properties: {
              query: { type: 'string', description: '搜索查询' }
            },
            required: ['query']
          },
          handler: async ({ query }) => {
            // 网络搜索实现
            return `搜索结果：${query}`;
          }
        }),
        createTool({
          name: 'generate_code',
          description: '生成指定语言的代码',
          parameters: {
            type: 'object',
            properties: {
              description: { type: 'string', description: '代码应该做什么' },
              language: { type: 'string', description: '编程语言' }
            },
            required: ['description', 'language']
          },
          handler: async ({ description, language }) => {
            // 代码生成实现
            return `// ${language} 代码：${description}\nconsole.log('生成的代码');`;
          }
        })
      ],
      model: {
        apiKey: process.env.OPENAI_API_KEY,
        baseURL: 'https://api.openai.com/v1',
        model: 'gpt-4'
      }
    });
  }

  async run(input: string, runOptions?: { sessionId?: string }) {
    // 从会话元数据获取当前选项
    const sessionMetadata = this.getEventStream().getSessionMetadata(runOptions?.sessionId);
    const options = sessionMetadata?.agentOptions || {};

    // 根据选项构建自定义指令
    let customInstructions = this.buildCustomInstructions(options);

    // 临时更新此次运行的指令
    const originalInstructions = this.instructions;
    this.instructions = customInstructions;

    try {
      const result = await super.run(input);
      return result;
    } finally {
      // 恢复原始指令
      this.instructions = originalInstructions;
    }
  }

  private buildCustomInstructions(options: any): string {
    let instructions = this.instructions;

    // 应用个性和沟通风格
    const personality = options.personalityMode || 'friendly';
    const style = options.communicationStyle || 'detailed';
    instructions += this.getPersonalityInstructions(personality, style);

    // 思考过程
    if (options.showThinkingProcess) {
      instructions += '\n\n始终逐步解释您的推理过程。';
    }

    // 进度指示器
    if (options.showProgressIndicators) {
      instructions += '\n\n执行长时间操作时，提供进度更新。';
    }

    // 工具偏好
    if (!options.enableWebSearch) {
      instructions += '\n\n除非绝对必要，否则不要使用网络搜索工具。';
    }

    if (!options.enableCodeGeneration) {
      instructions += '\n\n除非特别要求，否则避免生成代码。';
    }

    if (!options.enableImageAnalysis) {
      instructions += '\n\n除非特别要求，否则不要分析图像。';
    }

    // 代码语言偏好
    if (options.preferredCodeLanguage) {
      instructions += `\n\n生成代码时，除非指定其他语言，否则优先使用 ${options.preferredCodeLanguage}。`;
    }

    // 输出格式
    const format = options.outputFormat || 'markdown';
    if (format === 'html') {
      instructions += '\n\n使用 HTML 标签而不是 markdown 格式化回复。';
    } else if (format === 'plain') {
      instructions += '\n\n使用纯文本格式，不使用 markdown 或 HTML。';
    }

    // 来源引用
    if (options.includeSourceReferences) {
      instructions += '\n\n适用时始终包含来源引用和引用。';
    }

    // 推理步骤限制
    const maxSteps = options.maxReasoningSteps;
    if (maxSteps && maxSteps !== 'unlimited') {
      instructions += `\n\n将推理限制在最多 ${maxSteps} 个步骤内。`;
    }

    // 响应时间偏好
    const timePreference = options.responseTimePreference || 'balanced';
    if (timePreference === 'fast') {
      instructions += '\n\n优先考虑快速响应而不是彻底性。';
    } else if (timePreference === 'thorough') {
      instructions += '\n\n优先考虑彻底性和准确性而不是响应速度。';
    }

    // 内容安全
    const safetyLevel = options.contentSafetyLevel || 'moderate';
    if (safetyLevel === 'strict') {
      instructions += '\n\n应用严格的内容过滤并避免任何潜在敏感话题。';
    } else if (safetyLevel === 'permissive') {
      instructions += '\n\n在保持基本安全准则的同时对内容更加灵活。';
    }

    // 实验性功能
    if (options.enableExperimentalFeatures) {
      instructions += '\n\n您可以使用实验性功能和前沿能力。';
    }

    return instructions;
  }

  private getPersonalityInstructions(personality: string, style: string): string {
    const personalities = {
      professional: {
        concise: '\n\n保持专业语调，回复简洁直接。',
        detailed: '\n\n保持专业语调，提供全面、结构良好的回复。',
        explanatory: '\n\n保持专业语调，同时彻底解释概念和推理。',
      },
      friendly: {
        concise: '\n\n保持温暖友好的态度，回复简洁有用。',
        detailed: '\n\n保持温暖、友好和对话式的态度，提供详细解释。',
        explanatory: '\n\n保持友好和热情，同时逐步解释说明。',
      },
      technical: {
        concise: '\n\n专注于技术准确性，回复精确高效。',
        detailed: '\n\n提供技术准确和全面的信息。',
        explanatory: '\n\n专注于技术准确性，同时清楚地解释复杂概念。',
      },
      creative: {
        concise: '\n\n富有想象力和创新性，回复具有创意和启发性。',
        detailed: '\n\n探索创意方法并提供创新、详细的解决方案。',
        explanatory: '\n\n分享创意思维过程和创新的问题解决方法。',
      },
    };

    return personalities[personality]?.[style] || personalities.friendly.detailed;
  }
}

export { advancedServerOptions, AdvancedMultiModalAgent };
```

## 关键概念

### 选项类型

```typescript
// 布尔值 - 切换开关
{
  type: 'boolean',
  title: '功能名称',
  description: '这个功能的作用',
  default: false
}

// 二元枚举 - 两个按钮
{
  type: 'string',
  enum: ['选项1', '选项2'],
  default: '选项1'
}

// 多元枚举 - 下拉菜单
{
  type: 'string',
  enum: ['选项1', '选项2', '选项3'],
  default: '选项1'
}
```

### 访问选项

```typescript
class MyAgent extends Agent {
  async run(input: string, runOptions?: { sessionId?: string }) {
    const sessionMetadata = this.getEventStream().getSessionMetadata(runOptions?.sessionId);
    const options = sessionMetadata?.agentOptions || {};
    const isFeatureEnabled = options.featureName || false;
    
    // 使用选项来自定义行为
    return super.run(input);
  }
}
```

## 最佳实践

### 1. 清晰的命名

```typescript
// ✅ 好 - 清晰、描述性的名称
{
  enableDebugMode: { type: 'boolean', title: '调试模式' },
  responseFormat: { type: 'string', enum: ['json', 'markdown'] }
}

// ❌ 避免 - 不清楚的缩写
{
  dbg: { type: 'boolean' },
  fmt: { type: 'string' }
}
```

### 2. 有用的描述

```typescript
// ✅ 好 - 清晰的描述
{
  verboseLogging: {
    type: 'boolean',
    title: '详细日志',
    description: '在回复中包含详细的调试日志',
    default: false
  }
}

// ❌ 避免 - 缺少或模糊的描述
{
  verboseLogging: {
    type: 'boolean',
    title: '详细日志'
    // 没有描述 - 用户不知道这是做什么的
  }
}
```

### 3. 合理的默认值

```typescript
// ✅ 好 - 安全、常用的默认值
{
  enableExperimentalFeatures: {
    type: 'boolean',
    default: false  // 实验性功能的安全默认值
  },
  responseLanguage: {
    type: 'string',
    enum: ['chinese', 'english', 'japanese'],
    default: 'chinese'  // 最常见的默认值
  }
}
```

## 测试您的实现

1. 使用新配置启动您的智能体服务器
2. 打开 UI 并开始新的聊天会话
3. 在聊天输入区域查找"选项"按钮
4. 切换不同选项并验证它们是否影响智能体行为
5. 检查选项是否在同一会话的消息中持续存在

## 常见模式

### 功能切换
```typescript
if (options.enableWebSearch) {
  // 使用网络搜索工具
  const results = await this.callTool('web_search', { query });
}
```

### 条件指令
```typescript
let instructions = this.instructions;
if (options.verboseMode) {
  instructions += '\n\n为所有回复提供详细解释。';
}
```

### 个性切换
```typescript
const personality = options.personality || 'friendly';
const greeting = this.getGreeting(personality);
```

### 性能调优
```typescript
const maxSteps = parseInt(options.maxSteps) || 10;
// 将步骤限制应用于推理过程
```

## 下一步

- 探索 [Agent 选项文档](/guide/advanced/agent-options)
- 学习 [自定义工具](/examples/custom-tools)
- 查看 [服务器集成](/examples/server-integration)
- 阅读 [自定义 Hooks](/examples/custom-hooks)